/*! FacebookScript.js 1.0.0.0
 * 
 */
require(["ss","jquery","jqueryUI"],function(n,$){function t(){}function r(){}function i(t,i,r,u,f){this.m_checked=!0,this.$0=i,this.$2=t,this.$3=r,this.$1=u;var e;(e=Office.context.document.settings.get(this.get_id()))?this.m_checked=e:(this.m_checked=n.value(f,!1),Office.context.document.settings.set(this.get_id(),this.m_checked))}function e(n,t){i.call(this,n,t,null,null)}function u(n,t,r,u,f,e,o){i.call(this,n,t,f,e),this.$4=r,this.$5=u,this.$6=o}function h(n,t,r,u,f){i.call(this,n,t,u,f),this.subField=r}var a=this,f,o,s,c,l;t.setError=function(n){t.$5.find("#errorText").text(n),t.setView(t.$5)},t.setView=function(n){$.each(t.$6,function(i,r){r===n?t.show(r):t.hide(r)})},t.handleFacebookAuthEvent=function(i){i.status==="connected"?(t.userID=i.authResponse.userID,t.accessToken=i.authResponse.accessToken,t.setView(t.$4),r.logAction("LogIn",n.value(t.userID,"Unknown"),"",t.accessToken)):(r.logAction("LogOut",n.value(t.userID,"Unknown"),"",t.accessToken),t.userID=null,t.accessToken=null,t.setView(t.$0))},t.handleFacebookLogon=function(){r.logAction("Login Button Pressed",t.userID,"",""),t.logonToFacebook("email",t.handleFacebookAuthEvent)},t.logonToFacebook=function(n,t){var i={};i.scope=n,FB.login(t,i)},t.initFields=function(){t.fields={},t.fields.uid=new e("uid","FBID"),t.fields.first_name=new i("first_name","First Name","Basic",null,!0),t.fields.last_name=new i("last_name","Last Name","Basic",null,!0),t.fields.birthday_date=new i("birthday_date","Birthday","Basic","friends_birthday",!0),t.fields.sex=new i("sex","Sex","Basic",null,!0),t.fields.mutual_friend_count=new i("mutual_friend_count","Mutual Friends","Counts",null),t.fields.quotes=new i("quotes","Quotes","Extended","friends_likes",!1),t.fields.political=new i("political","Political","Extended","friends_religion_politics"),t.fields.relationship_status=new i("relationship_status","Relationship Status","Extended","friends_relationships",null),t.fields.religion=new i("religion","Religion","Extended","friends_religion_politics"),t.fields.wall_count=new i("wall_count","Wall Count","Counts",null),t.fields.friend_count=new i("friend_count","Friend Count","Counts",null),t.fields.work_Employer=new u("work","Employer","employer","name","Employment","friends_work_history",0),t.fields.work_Position=new u("work","Position","position","name","Employment","friends_work_history",0),t.fields.current_location_City=new u("current_location","Current City","city",null,"Location","friends_location"),t.fields.current_location_State=new u("current_location","Current State","state",null,"Location","friends_location"),t.fields.current_location_Country=new u("current_location","Current Country","country",null,"Location","friends_location"),t.fields.interests=new i("interests","Interests","Extended","friends_interests"),t.fields.profile_url=new i("profile_url","Profile URL","Extended",null),t.fields.sports=new h("sports","Sports","name","Extended","friends_likes"),t.fields.status_Message=new u("status","Current Status","message",null,"Extended",null)},t.insertAccordions=function(){var u=$("#fieldchoices"),r={};$.each(t.fields,function(n,t){var i=t;i.get_containerName()!=null&&(r[i.get_containerName()]==null&&(r[i.get_containerName()]=[]),r[i.get_containerName()][r[i.get_containerName()].length]=i)}),$.each(r,function(i,r){var f=[],e=!0,o;$.each(r,function(n,t){t.m_checked||(e=!1),f[f.length]=t.get_html()}),o="<div class='group' id='group{0}'><h3>{0}<\/h3><div><input id='ah{0}' {1} type='checkbox'  />Select All<br/>{2}<\/div><\/div>",u.append(n.format(o,i,e?"checked='checked'":"",f.join("<br/>"))),$("#ah"+i).change(t.handleAccordionSelectAll)}),$("#fieldchoices").accordion({header:"> div > h3",collapsible:!0,heightStyle:"content"}),$("input[id^='"+i.checkBoxPrefix+"']").change(t.handleFieldChange),Office.context.document.settings.saveAsync(function(){})},t.updateFieldChecked=function(n,i){$.each(t.fields,function(t,r){var u=r;u.get_id()===n&&(u.updateChecked(i),Office.context.document.settings.saveAsync(function(){}))})},t.handleFieldChange=function(n){var i=$("#"+n.target.id).is(":checked");t.updateFieldChecked(n.target.id,i)},t.handleAccordionSelectAll=function(n){var r=n.target.id.substr(2),i=$("#"+n.target.id).is(":checked");$("#group"+r+" input[type='checkbox']").each(function(n,r){r.checked=i,t.updateFieldChecked(r.id,i)})},t.logOutOfFacebook=function(){FB.logout(t.handleFacebookAuthEvent)},t.hide=function(n){setTimeout(function(){n.hide()},0)},t.show=function(n){setTimeout(function(){n.show()},0)},t.insertFriends=function(){var i,n,u,f;t.setView(t.$3),i=new Office.TableData,n=[],i.headers=new Array(1),i.headers[0]=[],u=[],f={},$.each(t.fields,function(t,r){var e=r;e.get_checked()&&(f[t]=e,i.headers[0][i.headers[0].length]=e.get_displayText(),n[n.length]=e.get_fieldName(),e.get_permission()!=null&&u.indexOf(e.get_permission())<0&&(u[u.length]=e.get_permission()))}),n=n.filter(function(t,i){return n.indexOf(t)===i});var o=n.join(","),s="SELECT "+o+" FROM user WHERE uid IN (SELECT uid2 from friend WHERE uid1 = me())",e={};e.q=s,t.logonToFacebook(u.join(),function(n){n.status==="connected"?FB.api("fql",e,function(n){n.error?r.logAction("GetDataFromFacebook",t.userID,n.error,"Could not get data from facebook"):t.insertFreindsIntoExcel(n.data,i,f)}):t.handleFacebookAuthEvent(n)})},t.insertFreindsIntoExcel=function(i,u,f){var e,o,h,c,s;for(u.rows=new Array(i.length),e=0;e<i.length;e++)for(u.rows[e]=new Array(u.headers[0].length),o=0;o<u.headers[0].length;o++)h=n.keys(f)[o],c=t.fields[h],u.rows[e][o]=c.parseResult(i[e]);s={},s.coercionType=Office.CoercionType.Table,Office.context.document.bindings.getByIdAsync(t.tableBinding,function(n){if(n.error==null){var i=n.value;i.getDataAsync(s,function(f){var o=u.headers[0].length-f.value.headers[0].length,s,e;o>0?(s=t.generateTableData(o,f.value.rows.length),i.addColumnsAsync(s,function(){Office.context.document.bindings.getByIdAsync(t.tableBinding,function(n){var f=n.value,i={};i.coercionType=Office.CoercionType.Table,f.setDataAsync(u,i,function(n){r.logAction("Insert Data",t.userID,"","Existing Table Resize"),n.status===Office.AsyncResultStatus.Failed?(t.setError("An error has occurred please try again"),r.logAction("Insert Data",t.userID,"Message: "+n.error.message+" Code: "+n.error.code,"Existing Table Resize")):r.logAction("Insert Data",t.userID,"","Existing Table")})})})):(e={},e.coercionType=Office.CoercionType.Table,i.setDataAsync(u,e,function(i){n.status===Office.AsyncResultStatus.Failed?(t.setError("An error has occurred please try again"),r.logAction("Insert Data",t.userID,"Message: "+i.error.message+" Code: "+i.error.code,"Existing Table")):r.logAction("Insert Data",t.userID,"","Existing Table")}))})}else Office.context.document.setSelectedDataAsync(u,s,function(n){if(n.status===Office.AsyncResultStatus.Failed&&(r.logAction("Insert Data",t.userID,"Message: "+n.error.message+" Code: "+n.error.code,"New Table"),n.error.code===2003?t.setError("Setting the friends list here would overwrite data in the spread sheet. Please select another area"):t.setError("An error has occurred please try again")),n.status===Office.AsyncResultStatus.Succeeded){var i={};i.id=t.tableBinding,Office.context.document.bindings.addFromSelectionAsync(Office.BindingType.Table,i,function(){Office.select("bindings#"+t.tableBinding).addHandlerAsync(Office.EventType.BindingSelectionChanged,t.handleTableSelection)}),r.logAction("Insert Data",t.userID,"","New Table")}})}),t.updateFriendView(u.rows[0][0]),t.setView(t.$2)},t.generateTableData=function(n,t){var i=new Office.TableData,f,r,u;for(i.headers=new Array(1),i.headers[0]=[],i.rows=new Array(t),f=0;f<n;f++)i.headers[0][i.headers[0].length]="Column"+f;for(r=0;r<t;r++)for(i.rows[r]=new Array(n),u=0;u<n;u++)i.rows[r][u]="Data"+r+u;return i},t.setProfilePic=function(n){$("#profilepic").css("background","url(http://graph.facebook.com/"+n+"/picture?width=200&height=200) no-repeat center center")},t.handleTableSelection=function(n){if(t.userID!=null){if(n.startRow>0){var i={};i.startRow=n.startRow,i.startColumn=0,i.rowCount=1,i.columnCount=1,i.coercionType=Office.CoercionType.Table,Office.select("bindings#"+t.tableBinding).getDataAsync(i,function(n){n.status===Office.AsyncResultStatus.Succeeded&&t.updateFriendView(n.value.rows[0][0])})}t.setView(t.$2)}},t.updateFriendView=function(n){var i=[],r;t.setProfilePic(n),t.userID!=null&&(FB.api("/"+n+"?fields=name",function(n){$("#friendname").html(n.name)}),r=t.userID+"/mutualfriends/"+n,FB.api(r,function(n){for(var t=0;t<n.data.length;t++)i[i.length]=n.data[t].name;i.sort(),$("#friendlist").html(i.join("<br/>"))}))},t.postFriendStatus=function(){if(t.friendID!=null&&!!t.friendID){var n={};n.to=t.friendID,n.from=t.userID,n.method="feed",n.display="page",FB.ui(n,function(n){document.write(n.post_id)})}},r.logAction=function(n,t,i,u){var f={};f.action=n,f.userID=t,f.environment=r.environment,f.error=i,f.message=u,$.get(r.URL+"Friends.svc/LogAction",f,function(){}).error(function(n,t){var i=t})},f={parseResult:function(t){return n.value(t[this.get_fieldName()],"Unknown")},get_displayText:function(){return this.$0},get_permission:function(){return this.$1},get_containerName:function(){return this.$3},get_fieldName:function(){return this.$2},get_html:function(){var t="<input id='{0}' type='checkbox' "+(this.m_checked?"checked='checked'":"")+" />{1}";return n.format(t,this.get_id(),this.get_displayText())},get_checked:function(){return $("#"+this.get_id()).is(":checked")},set_checked:function(n){return $("#"+this.get_id())[0].checked=n,n},get_id:function(){return i.checkBoxPrefix+this.get_fieldName()},updateChecked:function(n){Office.context.document.settings.set(this.get_id(),n)}},o={get_checked:function(){return!0},set_checked:function(n){return n},get_html:function(){return null}},s={parseResult:function(t){var i=null;try{if(this.$6==null)if(this.$5==null)i=t[this.get_fieldName()][this.$4];else throw n.error("Not Implemented",null);else i=t[this.get_fieldName()][this.$6][this.$4][this.$5]}catch(r){}return n.value(i,"Unknown")}},c={parseResult:function(t){var f=null,u,i,r;try{for(u=t[this.get_fieldName()],i=[],r=0;r<u.length;r++)i[i.length]=u[r][this.subField];f=i.join(",")}catch(e){}return n.value(f,"Unknown")}},l=n.module("FacebookScript",null,{FacebookScript:[t,null,null],Requests:[r,null,null],Field:[i,f,null],RequiredField:[e,o,i],StructField:[u,s,i],ArrayField:[h,c,i]}),t.tableBinding="TableBinding",t.$6=[],t.$7=!1,window.fbAsyncInit=function(){var n={};n.appId="143445839182832",n.channelUrl="http://localhost:62587/pages/channel.ashx",n.status=!0,n.cookie=!1,FB.init(n),FB.getLoginStatus(t.handleFacebookAuthEvent),t.$7=!0,$("body").height($(window).height()),$("body").width($(window).width()-25)},Office.initialize=function(){var f,u,e,i;$("#GetFriends").click(t.insertFriends),$("#LogOut").click(t.logOutOfFacebook),$("#postfriendstatus").click(t.postFriendStatus),$("#btnlogon").click(t.handleFacebookLogon),$("#insertfreinds").click(t.insertFriends),$("img[id$='main']").click(function(){t.setView(t.$4)}),$("#settings").click(function(){t.setView(t.$1)}),t.$2=$("#friend"),t.$6[t.$6.length]=t.$2,t.$0=$("#logon"),t.$6[t.$6.length]=t.$0,t.$1=$("#insert"),t.$6[t.$6.length]=t.$1,t.$3=$("#modal"),t.$6[t.$6.length]=t.$3,t.$4=$("#main"),t.$6[t.$6.length]=t.$4,t.$5=$("#error"),t.$6[t.$6.length]=t.$5,t.initFields(),t.insertAccordions(),f={},f.id=t.tableBinding,Office.context.document.bindings.addFromNamedItemAsync("Names",Office.BindingType.Table,f),setTimeout(function(){t.$7||window.fbAsyncInit()},2e3),u=document.getElementsByTagName("script")[0],e="facebook-jssdk",u.id!==e&&(i=document.createElement("script"),i.id=e,i.setAttribute("async",!0),i.src="//connect.facebook.net/en_US/all.js",u.parentNode.insertBefore(i,u)),Office.context.document.bindings.getByIdAsync(t.tableBinding,function(n){n.error==null&&Office.select("bindings#"+t.tableBinding).addHandlerAsync(Office.EventType.BindingSelectionChanged,t.handleTableSelection)}),r.logAction("Init",n.value(t.userID,"unknown"),"","")},r.environment="Test",r.URL="http://localhost:62587/",i.checkBoxPrefix="fieldscb",i.nullToken="Unknown"})